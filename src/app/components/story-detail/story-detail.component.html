<!-- P√°gina de Detalle del Cuento -->
<div class="min-h-screen bg-tiyc-gradient">
  <div class="container mx-auto px-4 py-8">
    <div class="container-tiyc">
      
      <!-- Estado de Loading -->
      <div *ngIf="isLoading" class="p-8">
        <div class="text-center py-16">
          <div class="text-6xl mb-6 animate-bounce">üìñ</div>
          <h3 class="text-tiyc-brown font-bold text-xl mb-4">Cargando cuento...</h3>
          <p class="text-gray-600">Preparando la historia para ti</p>
          <div class="flex justify-center mt-6">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-tiyc-brown"></div>
          </div>
        </div>
      </div>
      
      <!-- Estado de Error -->
      <div *ngIf="error && !isLoading" class="p-8">
        <div class="text-center py-16">
          <div class="text-6xl mb-6">üòû</div>
          <h3 class="text-red-600 font-bold text-xl mb-4">Error al cargar el cuento</h3>
          <p class="text-gray-600 mb-6">{{ error }}</p>
          <div class="flex gap-3 justify-center">
            <button 
              (click)="goBack()"
              class="btn-tiyc-secondary px-6 py-3"
            >
              ‚Üê Volver a Biblioteca
            </button>
            <button 
              (click)="loadStoryDetail()"
              class="btn-tiyc-primary px-6 py-3"
            >
              üîÑ Intentar de nuevo
            </button>
          </div>
        </div>
      </div>
      
      <!-- Cuento Cargado -->
      <div *ngIf="storyData && !isLoading && !error">
        
        <!-- Header del cuento -->
        <div class="bg-gradient-to-r from-tiyc-header to-amber-400 text-white p-6">
          <!-- Navegaci√≥n superior -->
          <div class="flex justify-between items-center mb-6">
            <button 
              (click)="goBack()"
              class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-xl font-semibold transition-all duration-200 flex items-center gap-2"
            >
              ‚Üê Biblioteca
            </button>
            <div class="flex gap-2">
              <button 
                (click)="exportToPDF()"
                class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-xl font-semibold transition-all duration-200 flex items-center gap-2"
              >
                üìÑ <span class="hidden sm:inline">PDF</span>
              </button>
              <button 
                (click)="shareStory()"
                class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-xl font-semibold transition-all duration-200 flex items-center gap-2"
              >
                üì§ <span class="hidden sm:inline">Compartir</span>
              </button>
            </div>
          </div>
          
          <!-- Informaci√≥n del cuento -->
          <div class="text-center">
            <h1 class="text-3xl sm:text-4xl font-bold mb-4">{{ storyData.story.title }}</h1>
            <div class="flex flex-wrap justify-center gap-3 text-sm">
              <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full font-semibold flex items-center gap-1">
                {{ getCategoryEmoji(storyData.story.category) }} {{ storyData.story.category }}
              </span>
              <span 
                class="text-white px-3 py-1 rounded-full font-semibold"
                [ngClass]="getPedagogicalApproachLabel(storyData.story.pedagogical_approach).color"
              >
                üéØ {{ getPedagogicalApproachLabel(storyData.story.pedagogical_approach).label }}
              </span>
              <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full font-semibold">
                üìÖ {{ formatDate(storyData.story.created_at) }}
              </span>
            </div>
          </div>
          
          <!-- Estad√≠sticas del cuento -->
          <div class="flex justify-center gap-6 mt-6 text-sm">
            <div class="text-center">
              <div class="font-bold text-lg">{{ getOrderedScenarios().length }}</div>
              <div class="opacity-75">Escenas</div>
            </div>
            <div class="text-center">
              <div class="font-bold text-lg">{{ getTotalImages() }}</div>
              <div class="opacity-75">Im√°genes</div>
            </div>
            <div class="text-center">
              <div class="font-bold text-lg">{{ storyData.story.content.split(' ').length }}</div>
              <div class="opacity-75">Palabras</div>
            </div>
          </div>
        </div>
        
        <!-- Contenido del cuento -->
        <div class="bg-white">
          
          <!-- Escenarios del cuento como libro narrativo -->
          <div class="p-6">
            <h2 class="text-tiyc-brown font-bold text-xl mb-6 text-center flex items-center justify-center gap-2">
              üìñ Historia Completa
            </h2>
            
            <!-- Cada escenario con m√°s contenido narrativo -->
            <div class="space-y-12">
              <div *ngFor="let scenario of getOrderedScenarios(); let i = index" 
                   class="chapter-container bg-gradient-to-r from-gray-50 to-white rounded-2xl overflow-hidden shadow-lg">
                
                <!-- Header del escenario -->
                <div class="chapter-header bg-gradient-to-r from-tiyc-tan to-amber-400 text-white px-6 py-4">
                  <div class="flex justify-between items-center relative z-10">
                    <h3 class="font-bold text-xl">
                      {{ getChapterTitle(i + 1) }}
                    </h3>
                    <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm font-semibold">
                      Cap√≠tulo {{ i + 1 }} de {{ getOrderedScenarios().length }}
                    </span>
                  </div>
                </div>
                
                <!-- Layout mejorado para lectura -->
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-0">
                  
                  <!-- Imagen del escenario (2 columnas en desktop) -->
                  <div class="lg:col-span-2 relative chapter-image">
                    <img 
                      *ngIf="scenario.image"
                      [src]="getImageUrl(scenario.image.image_url)"
                      [alt]="'Cap√≠tulo ' + (i + 1) + ' - ' + scenario.description"
                      class="w-full h-80 lg:h-96 object-cover"
                    >
                    
                    <!-- Placeholder si no hay imagen -->
                    <div *ngIf="!scenario.image" 
                         class="w-full h-80 lg:h-96 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                      <div class="text-center text-gray-500">
                        <div class="text-5xl mb-3">üñºÔ∏è</div>
                        <div class="font-medium">Imagen no disponible</div>
                      </div>
                    </div>
                    
                    <!-- Badge del n√∫mero de cap√≠tulo -->
                    <div class="chapter-badge absolute top-4 left-4 bg-tiyc-brown text-white w-16 h-16 rounded-full flex items-center justify-center font-bold text-xl shadow-lg border-4 border-white">
                      {{ i + 1 }}
                    </div>
                  </div>
                  
                  <!-- Contenido narrativo expandido (3 columnas en desktop) -->
                  <div class="lg:col-span-3 p-8 flex flex-col justify-center">
                    <div class="narrative-content reading-content prose prose-lg max-w-none">
                      
                      <!-- Descripci√≥n principal del escenario -->
                      <div class="mb-6">
                        <h4 class="text-tiyc-brown font-bold text-lg mb-4 border-b-2 border-tiyc-light pb-2">
                          En esta parte de la historia...
                        </h4>
                        <p class="text-gray-800 leading-relaxed text-lg font-medium">
                          {{ scenario.description }}
                        </p>
                      </div>
                      
                      <!-- Contenido narrativo adicional -->
                      <div class="mb-6">
                        <h4 class="text-tiyc-brown font-bold text-lg mb-4 border-b-2 border-tiyc-light pb-2">
                          La historia contin√∫a...
                        </h4>
                        <div class="text-gray-700 leading-relaxed text-base space-y-4">
                          <p>{{ getStoryContentForScene(i) }}</p>
                        </div>
                      </div>
                      
                    </div>
                  </div>
                </div>
                
                <!-- Separador decorativo (solo si no es el √∫ltimo) -->
                <div *ngIf="i < getOrderedScenarios().length - 1" class="chapter-separator"></div>
                
              </div>
            </div>
            
            <!-- Final del cuento mejorado -->
            <div class="story-ending text-center py-16 mt-12 bg-gradient-to-b from-white to-tiyc-light rounded-2xl relative">
              <div class="relative z-10">
                <div class="text-7xl mb-6 animate-bounce">üåü</div>
                <h3 class="text-tiyc-brown font-bold text-3xl mb-6">¬°Fin de la Historia!</h3>
                <div class="max-w-2xl mx-auto">
                  <p class="text-gray-700 text-lg mb-6 leading-relaxed">
                    Esta hermosa historia ha llegado a su final. Esperamos que haya despertado la imaginaci√≥n, 
                    transmitido valores importantes y creado momentos especiales de lectura.
                  </p>
                  <p class="text-gray-600 mb-8">
                    Cada imagen y cada palabra fueron creadas especialmente para inspirar y educar.
                  </p>
                </div>
                
                <!-- Acciones finales -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                  <button 
                    (click)="createNew()"
                    class="btn-tiyc-primary px-8 py-4 flex items-center justify-center gap-2 text-lg transform hover:scale-105 transition-all duration-200"
                  >
                    ‚ú® Crear Nueva Historia
                  </button>
                  <button 
                    (click)="goBack()"
                    class="btn-tiyc-secondary px-8 py-4 flex items-center justify-center gap-2 text-lg transform hover:scale-105 transition-all duration-200"
                  >
                    üìö Volver a Mi Biblioteca
                  </button>
                </div>
              </div>
            </div>
            
          </div>
          
        </div>
        
      </div>
      
    </div>
  </div>
</div>