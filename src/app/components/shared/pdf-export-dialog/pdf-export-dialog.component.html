<!-- templates/pdf/story_standard.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ metadata.title }}</title>
    
    <!-- Metadatos del PDF -->
    <meta name="author" content="{{ metadata.author }}">
    <meta name="subject" content="{{ metadata.subject }}">
    <meta name="keywords" content="{{ metadata.keywords | join(', ') }}">
    <meta name="creator" content="{{ metadata.creator }}">
    
    <style>
        /* Estilos CSS se inyectan aqu√≠ por WeasyPrint */
    </style>
</head>
<body>
    <!-- PORTADA -->
    <div class="cover-page">
        <div class="cover-header">
            <div class="logo-section">
                <div class="logo-placeholder">
                    <!-- Logo TIYC aqu√≠ -->
                    <h1 class="logo-text">TIYC</h1>
                    <p class="logo-subtitle">T√∫ Inspiras, Yo Creo</p>
                </div>
            </div>
            
            <div class="school-info">
                <h2 class="school-name">{{ story.school_name or "Unidad Educativa Santa Fe" }}</h2>
                <p class="school-subtitle">Sistema de Generaci√≥n de Cuentos Ilustrados</p>
            </div>
        </div>
        
        <div class="cover-content">
            <div class="story-title-section">
                <h1 class="story-title">{{ story.title }}</h1>
                
                <div class="story-badges">
                    <span class="badge category-badge">
                        üìö {{ story.category }}
                    </span>
                    
                    <span class="badge approach-badge approach-{{ story.pedagogical_approach }}">
                        üéØ {{ pedagogical_labels.get(story.pedagogical_approach, story.pedagogical_approach) }}
                    </span>
                    
                    <span class="badge age-badge">
                        üéì {{ story.target_age }}
                    </span>
                </div>
                
                <div class="story-stats">
                    <div class="stat-item">
                        <span class="stat-number">{{ total_scenarios }}</span>
                        <span class="stat-label">Escenas</span>
                    </div>
                    
                    {% if has_images %}
                    <div class="stat-item">
                        <span class="stat-number">{{ story.scenarios | selectattr("image") | list | length }}</span>
                        <span class="stat-label">Ilustraciones</span>
                    </div>
                    {% endif %}
                    
                    <div class="stat-item">
                        <span class="stat-number">{{ story.content | word_count }}</span>
                        <span class="stat-label">Palabras</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="cover-footer">
            <div class="author-info">
                <p class="author-label">Creado por:</p>
                <p class="author-name">{{ story.teacher_name }}</p>
                <p class="creation-date">{{ story.creation_date }}</p>
            </div>
            
            <div class="generation-info">
                <p class="generation-text">Generado el {{ generation_date }}</p>
                <p class="watermark">{{ config.watermark or "TIYC - T√∫ Inspiras, Yo Creo" }}</p>
            </div>
        </div>
    </div>
    
    <!-- P√ÅGINA DE INFORMACI√ìN PEDAG√ìGICA -->
    {% if config.include_metadata %}
    <div class="info-page">
        <h2 class="info-title">Informaci√≥n Pedag√≥gica</h2>
        
        <div class="pedagogical-section">
            <h3 class="section-title">Enfoque Pedag√≥gico</h3>
            
            {% if story.pedagogical_approach == 'montessori' %}
            <div class="approach-description">
                <p><strong>M√©todo Montessori:</strong> Este cuento est√° dise√±ado siguiendo los principios Montessori, enfoc√°ndose en:</p>
                <ul>
                    <li>Experiencias de aprendizaje autodirigido</li>
                    <li>Actividades pr√°cticas y realistas</li>
                    <li>Desarrollo de la autonom√≠a e independencia</li>
                    <li>Respeto por el ritmo natural de aprendizaje</li>
                </ul>
            </div>
            {% elif story.pedagogical_approach == 'waldorf' %}
            <div class="approach-description">
                <p><strong>Pedagog√≠a Waldorf:</strong> Este cuento incorpora elementos de la pedagog√≠a Waldorf:</p>
                <ul>
                    <li>Desarrollo integral del ni√±o</li>
                    <li>Conexi√≥n con la naturaleza y los ritmos estacionales</li>
                    <li>Fomento de la imaginaci√≥n y creatividad</li>
                    <li>Aprendizaje a trav√©s del arte y la experiencia sensorial</li>
                </ul>
            </div>
            {% else %}
            <div class="approach-description">
                <p><strong>Enfoque Reggio Emilia:</strong> Este cuento utiliza principios de Reggio Emilia:</p>
                <ul>
                    <li>El ni√±o como protagonista de su aprendizaje</li>
                    <li>Aprendizaje colaborativo y participativo</li>
                    <li>Valoraci√≥n de la expresi√≥n creativa</li>
                    <li>Ambientes de aprendizaje estimulantes</li>
                </ul>
            </div>
            {% endif %}
        </div>
        
        <div class="usage-suggestions">
            <h3 class="section-title">Sugerencias de Uso</h3>
            <ul class="suggestions-list">
                <li>Lea el cuento en voz alta, permitiendo que los ni√±os observen las ilustraciones</li>
                <li>Fomente la participaci√≥n activa haciendo preguntas sobre las im√°genes</li>
                <li>Propicie discusiones sobre los valores y ense√±anzas del cuento</li>
                <li>Invite a los ni√±os a recrear escenas o continuar la historia</li>
                {% if story.pedagogical_approach == 'montessori' %}
                <li>Conecte elementos del cuento con actividades pr√°cticas de la vida real</li>
                {% elif story.pedagogical_approach == 'waldorf' %}
                <li>Utilice elementos art√≠sticos como dibujo o m√∫sica para complementar la lectura</li>
                {% else %}
                <li>Encourage expresi√≥n creativa a trav√©s de actividades posteriores a la lectura</li>
                {% endif %}
            </ul>
        </div>
    </div>
    {% endif %}
    
    <!-- CONTENIDO PRINCIPAL DEL CUENTO -->
    <div class="story-content">
        
        <!-- T√≠tulo y resumen -->
        <div class="content-header">
            <h1 class="content-title">{{ story.title }}</h1>
            {% if story.content | length > 200 %}
            <div class="story-summary">
                <p><em>{{ story.content | truncate_words(30) }}</em></p>
            </div>
            {% endif %}
        </div>
        
        <!-- Escenarios del cuento -->
        {% for scenario in story.scenarios %}
        <div class="scenario-section" data-scenario="{{ loop.index }}">
            
            <!-- Header del escenario -->
            <div class="scenario-header">
                <h2 class="scenario-title">
                    {% if loop.index == 1 %}
                        üåü El Comienzo de la Aventura
                    {% elif loop.index == story.scenarios | length %}
                        üéâ El Final de la Historia
                    {% elif loop.index == 2 %}
                        üé≠ El Desarrollo de la Historia
                    {% else %}
                        üìñ Cap√≠tulo {{ loop.index }}
                    {% endif %}
                </h2>
                <span class="scenario-number">{{ loop.index }} / {{ story.scenarios | length }}</span>
            </div>
            
            <!-- Imagen del escenario (si existe) -->
            {% if scenario.image and config.include_images %}
            <div class="scenario-image-container">
                <img src="{{ scenario.image.image_url }}" 
                     alt="Ilustraci√≥n del cap√≠tulo {{ loop.index }}" 
                     class="scenario-image">
                
                {% if scenario.image.prompt %}
                <div class="image-caption">
                    <p class="caption-text">{{ scenario.description }}</p>
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Contenido narrativo del escenario -->
            <div class="scenario-content">
                <div class="scenario-description">
                    <p class="description-text">{{ scenario.description }}</p>
                </div>
                
                <!-- Dividir contenido del cuento proporcionalmente -->
                {% set content_parts = story.content.split('\n\n') %}
                {% set part_index = ((loop.index0 * content_parts | length) / story.scenarios | length) | int %}
                {% if content_parts[part_index:((loop.index * content_parts | length) / story.scenarios | length) | int] %}
                <div class="narrative-content">
                    {% for paragraph in content_parts[part_index:((loop.index * content_parts | length) / story.scenarios | length) | int] %}
                    <p class="narrative-paragraph">{{ paragraph.strip() }}</p>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <!-- Separador entre escenarios (excepto el √∫ltimo) -->
            {% if not loop.last %}
            <div class="scenario-separator">
                <div class="separator-line"></div>
                <div class="separator-icon">‚ú¶</div>
                <div class="separator-line"></div>
            </div>
            {% endif %}
            
        </div>
        {% endfor %}
        
        <!-- Final del cuento -->
        <div class="story-ending">
            <div class="ending-decoration">
                <span class="ending-icon">üåü</span>
            </div>
            <h3 class="ending-title">Fin de la Historia</h3>
            <p class="ending-message">
                Esta hermosa historia ha llegado a su final. Esperamos que haya despertado 
                la imaginaci√≥n, transmitido valores importantes y creado momentos especiales de lectura.
            </p>
        </div>
    </div>
    
    <!-- PIE DE P√ÅGINA INFORMATIVO -->
    <div class="document-footer">
        <div class="footer-content">
            <div class="footer-left">
                <p class="footer-title">TIYC - T√∫ Inspiras, Yo Creo</p>
                <p class="footer-subtitle">Sistema de Generaci√≥n de Cuentos Ilustrados</p>
                <p class="footer-school">{{ story.school_name or "Unidad Educativa Santa Fe" }}</p>
            </div>
            
            <div class="footer-center">
                <div class="document-info">
                    <p><strong>Documento:</strong> {{ story.title }}</p>
                    <p><strong>Autor:</strong> {{ story.teacher_name }}</p>
                    <p><strong>Fecha de creaci√≥n:</strong> {{ story.creation_date }}</p>
                    <p><strong>Generado:</strong> {{ generation_date }}</p>
                </div>
            </div>
            
            <div class="footer-right">
                <div class="technical-info">
                    <p class="tech-line">Enfoque: {{ pedagogical_labels.get(story.pedagogical_approach, story.pedagogical_approach) }}</p>
                    <p class="tech-line">Categor√≠a: {{ story.category }}</p>
                    <p class="tech-line">Dirigido a: {{ story.target_age }}</p>
                    <p class="tech-line">Escenarios: {{ total_scenarios }}</p>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p class="copyright">
                ¬© 2025 TIYC - Todos los derechos reservados. 
                Este documento fue generado autom√°ticamente por el sistema TIYC.
            </p>
        </div>
    </div>

</body>
</html>